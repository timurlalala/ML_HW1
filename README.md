# Домашняя работа №1 по машинному обучению

## Что было сделано:

- Предобработка, EDA датасета и визуализации
- Обучены разные типы линейных моделей для предсказания цены автомобиля
- Немного feature-engineering и попытки улучшить качество бейзлайна
- Реализован пайплайн, совмещающий в себя все этапы обработки данных 
и предсказательную модель
- Написали бизнесовую метрику
- Реализован простейший API с двумя эндпоинтами

## Результаты

### EDA 
Данные были очищены от дубликатов, пропущенные значения были заполнены. 
В столбцах `mileage`, `engine`, `max_power` были удалены единицы измерения,
столбец `torque` был отброшен. Типы данных были приведены к соответствию.

Я обнаружил небольшую утечку трейна в тест (писал об этом в чате),
но в данном игрушечном примере это вряд ли привело бы к проблемам с моделью.

*Краткие выводы о данных:*
- Некоторые фичи коррелируют между собой, в частности пары
`(selling_price, max_power)`, `(engine, max_power)`, `(engine, seats)`
- По визуализациям можно увидеть, что цена растет вместе с мощностью 
двигателя, его объемом и годом выпуска, и падает с ростом километража
- Автомобили с большим объемом двигателя, как правило, мощнее
- Наблюдается тенденция в появлении на рынке более мощных автомобилей
в последние годы. Однако малолитражки продолжают производиться

### Бейзлайн

На вещественных признаках была обучена "ванильная" модель линейной регрессии.
Результат по метрикам, ожидаемо, не был блестящим. r2_score у такой модели 
составил `0.594`. Такую модель нельзя назвать точной

Коэффициенты, полученные при обучении модели, дали нам представление об 
относительной информативности фич. Самыми "важными" для предсказания оказались
мощность и год выпуска

### Улучшение бейзлайна

- Сначала применили технику стандартизации фич. Ожидаемо, это не повысило
точности модели.

- Дальше пробовали применять Lasso - регуляризацию. Для подобра гиперпараметра
использовали кросс-валидацию. К сожалению, качество модели только снизилось.

- Напоследок, закодировали по One-Hot категориальные фичи. Тут я трансформировал
столбец name, оставив только марку автомобиля - это позволило сохранить 
важную информацию, не раздувая многократно размерность модели. 

- Обученная на всех фичах модель с Ridge регуляризацией показала значительный 
прирост в качестве - `0.77` r2

**Таким образом, наибольший буст в качестве дало подключение категориальных фич**

Вывод - категориальные фичи могут нести важную информацию, и стоит всегда
рассматривать возможность использования их в своей модели

### Бизнесовая метрика

Как оказалось, наша модель с относительно высоким r2 скором лишь в трети случаев
ошибается меньше, чем на 10%.

Вывод - модель, выдающая неплохие метрики, может оказаться не такой уж и хорошей на практике.
Необходимо учитывать в первую очередь требования бизнеса и его метрики

### FastAPI

Был реализован пайплайн с доступом по API, включающий в себя все этапы предобработки данных и 
прогностическую модель.

![image](images/Снимок%20экрана%20от%202024-12-03%2021-15-07.png)

Два эндпоинта позволяют спрогнозировать цену как для одного объекта
![image](images/Снимок%20экрана%20от%202024-12-03%2021-17-34.png)

Так и для целого датасета в формате .csv
![image](images/Снимок%20экрана%20от%202024-12-03%2021-18-04.png)

## Что не получилось сделать:

- Преобразовать `torque` - скорее не успел. Вообще, я думал с помощью регулярного
выражения извлечь первое и второе число, и разделить первое на второе - 
тогда получилось бы одно число, характеризующее крутящий момент. Но
там также нужно учитывать, что в нескольких строках использовались килограммы, 
а не ньютоны
- Стоило попробовать оценить прирост качества остальных моделей при добавлении 
к ним категориальных фич.
- В идеале, было бы хорошо реализовать сохранение пайплайна с помощью кастомного
pickler'а, чтобы избежать конфликтов при переносе объекта в другое окружение.
Однако я пошел по пути наименьшего сопротивления - обучил и сохранил пайплайн
в таком же окружении, в котором использовал его.